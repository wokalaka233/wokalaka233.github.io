<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>wpfçš„Toolbox</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, sans-serif;
        }

        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            overflow-x: hidden;
        }

        /* å¯¼èˆªæ æŠ˜å æŒ‰é’®ï¼ˆè‰ºæœ¯å­—Fï¼‰ */
        .navbar-toggle {
            position: fixed;
            left: 20px;
            top: 20px;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            z-index: 101;
            transition: all 0.3s ease;
            font-family: 'Arial Black', sans-serif;
            /* è‰ºæœ¯å­—Fæ ·å¼ */
            text-shadow: 2px 2px 0 #764ba2, 4px 4px 0 rgba(0,0,0,0.1);
        }

        .navbar-toggle:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }

        /* å¯¼èˆªæ æ ·å¼ + åŠ¨ç”» */
        .navbar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: 240px;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            padding: 80px 0 30px;
            display: flex;
            flex-direction: column;
            z-index: 100;
            transition: transform 0.3s ease;
        }

        .navbar.hidden {
            transform: translateX(-100%);
        }

        .navbar-logo {
            text-align: center;
            margin-bottom: 50px;
            padding: 0 20px;
            animation: fadeInDown 1s ease;
        }

        .navbar-logo h2 {
            font-size: 24px;
            color: #667eea;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .navbar-logo p {
            color: #777;
            font-size: 14px;
        }

        .nav-list {
            list-style: none;
            flex: 1;
        }

        .nav-item {
            margin: 15px 0;
            opacity: 0;
            animation: fadeInLeft 0.5s ease forwards;
        }

        .nav-item:nth-child(1) { animation-delay: 0.2s; }
        .nav-item:nth-child(2) { animation-delay: 0.4s; }
        .nav-item:nth-child(3) { animation-delay: 0.6s; }
        .nav-item:nth-child(4) { animation-delay: 0.8s; }
        .nav-item:nth-child(5) { animation-delay: 1.0s; }

        .nav-link {
            display: block;
            padding: 12px 30px;
            color: #555;
            text-decoration: none;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            position: relative;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            left: 30px;
            bottom: 0;
            width: 0;
            height: 2px;
            background: #667eea;
            transition: width 0.3s ease;
        }

        .nav-link:hover, .nav-link.active {
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            border-left: 3px solid #667eea;
            padding-left: 35px;
        }

        .nav-link:hover::after, .nav-link.active::after {
            width: 40%;
        }

        /* ä¸»å†…å®¹åŒºæ ·å¼ */
        .main-content {
            margin-left: 240px;
            padding: 50px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 1s ease;
            transition: margin-left 0.3s ease;
        }

        .main-content.navbar-hidden {
            margin-left: 0;
        }

        .section {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            width: 100%;
            max-width: 800px;
            display: none;
            animation: slideUp 0.6s ease forwards;
            transform: translateY(30px);
            opacity: 0;
        }

        .section.active {
            display: block;
        }

        /* åŠ¨ç”»å®šä¹‰ */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInLeft {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* è‡ªæˆ‘ä»‹ç»æ¿å— */
        .intro-header {
            text-align: center;
            margin-bottom: 30px;
            animation: fadeInDown 0.8s ease;
        }

        .intro-header h2 {
            font-size: 32px;
            color: #333;
            margin-bottom: 10px;
            position: relative;
            display: inline-block;
        }

        .intro-header h2::after {
            content: '';
            display: block;
            width: 80px;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 2px;
            margin: 10px auto 0;
            animation: grow 1.2s ease;
        }

        @keyframes grow {
            from { width: 0; }
            to { width: 80px; }
        }

        .intro-content {
            line-height: 1.8;
            font-size: 16px;
            color: #555;
            animation: fadeIn 1s ease 0.3s forwards;
            opacity: 0;
        }

        .intro-content p {
            margin-bottom: 20px;
        }

        .intro-highlights {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 30px;
            animation: fadeIn 1s ease 0.6s forwards;
            opacity: 0;
        }

        .highlight-card {
            flex: 1;
            min-width: 200px;
            padding: 20px;
            background: rgba(102, 126, 234, 0.05);
            border-radius: 12px;
            border: 1px solid #eee;
            transition: all 0.3s ease;
        }

        .highlight-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            animation: pulse 0.6s ease;
        }

        .highlight-card h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .highlight-card p {
            font-size: 14px;
            color: #666;
            margin-bottom: 0;
        }

        /* BMIè®¡ç®—å™¨æ ·å¼ + åŠ¨ç”» */
        .bmi-header {
            text-align: center;
            margin-bottom: 30px;
            animation: fadeInDown 0.8s ease;
        }

        .bmi-header h2 {
            font-size: 28px;
            color: #333;
        }

        .bmi-container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            animation: fadeIn 1s ease 0.3s forwards;
            opacity: 0;
        }

        .input-box {
            margin: 15px 0;
            transition: all 0.3s ease;
        }

        .input-box label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .bmi-container input {
            padding: 8px;
            width: 200px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            transition: all 0.3s ease;
            outline: none;
        }

        .bmi-container input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            transform: translateX(5px);
        }

        .bmi-container button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .bmi-container button:hover {
            background-color: #45a049;
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(72, 187, 120, 0.2);
        }

        #bmi-result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            font-size: 18px;
            transition: all 0.3s ease;
            opacity: 0;
        }

        #bmi-result.show {
            opacity: 1;
            transform: translateY(0);
            animation: slideUp 0.5s ease;
        }

        /* ä¿„ç½—æ–¯æ–¹å—é€šç”¨æ ·å¼ */
        .tetris-header {
            text-align: center;
            margin-bottom: 20px;
            animation: fadeInDown 0.8s ease;
        }

        .tetris-header h2 {
            font-size: 28px;
            color: #333;
        }

        .tetris-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 30px;
            flex-wrap: wrap;
            width: 100%;
            margin-bottom: 20px;
            animation: fadeIn 1s ease 0.3s forwards;
            opacity: 0;
        }

        .tetris-main {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .tetris-board {
            border: 3px solid #667eea;
            border-radius: 8px;
            background: #f8f9fa;
            max-width: 90vw;
            height: auto;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.15);
            transition: all 0.3s ease;
        }

        .tetris-board:hover {
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.2);
        }

        .tetris-sidebar-pc {
            display: flex;
            flex-direction: column;
            gap: 20px;
            min-width: 180px;
        }

        .tetris-info {
            padding: 15px;
            background: rgba(102, 126, 234, 0.05);
            border-radius: 8px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .tetris-info:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .tetris-info h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .tetris-info p {
            font-size: 24px;
            font-weight: 600;
            color: #333;
            transition: all 0.3s ease;
        }

        .tetris-info p.update {
            animation: shake 0.3s ease;
        }

        .tetris-controls-pc {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .tetris-btn-pc {
            padding: 10px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .tetris-btn-pc:hover {
            opacity: 0.9;
            transform: scale(1.03);
            box-shadow: 0 3px 8px rgba(102, 126, 234, 0.2);
        }

        .tetris-btn-pc:active {
            transform: scale(0.98);
        }

        .tetris-btn-pc.special {
            background: linear-gradient(90deg, #f0a000, #f00000);
        }

        .controls-tip {
            margin-top: 10px;
            font-size: 13px;
            color: #666;
            text-align: center;
        }

        /* æ‰‹æœºç«¯ä¸“å±æ ·å¼ */
        .tetris-info-mobile {
            display: none;
            flex-direction: row;
            gap: 20px;
            margin-top: 15px;
            width: 100%;
            justify-content: center;
        }

        .tetris-controls-mobile {
            display: none;
            margin-top: 20px;
            width: 100%;
            animation: fadeIn 1s ease 0.6s forwards;
            opacity: 0;
        }

        .control-row {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .tetris-btn-mobile {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            color: white;
            border: none;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.2);
        }

        .tetris-btn-mobile.special {
            background: linear-gradient(90deg, #f0a000, #f00000);
        }

        .tetris-btn-mobile:hover {
            transform: scale(1.08);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .tetris-btn-mobile:active {
            transform: scale(0.95);
        }

        /* ç§‘å­¦è®¡ç®—å™¨æ ·å¼ + åŠ¨ç”» */
        .calc-header {
            text-align: center;
            margin-bottom: 30px;
            animation: fadeInDown 0.8s ease;
        }

        .calc-header h2 {
            font-size: 28px;
            color: #333;
        }

        .calc-container {
            max-width: 500px;
            margin: 0 auto;
            padding: 25px;
            background: rgba(102, 126, 234, 0.05);
            border-radius: 12px;
            animation: fadeIn 1s ease 0.3s forwards;
            opacity: 0;
        }

        .calc-display {
            width: 100%;
            height: 80px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 28px;
            text-align: right;
            overflow-x: auto;
            white-space: nowrap;
            transition: all 0.3s ease;
            cursor: text;
        }

        .calc-display:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .calc-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        .calc-btn {
            padding: 18px;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: #f1f3f5;
            color: #333;
        }

        .calc-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .calc-btn:active {
            transform: scale(0.98);
        }

        .calc-btn.operator {
            background: linear-gradient(90deg, #667eea, #764ba2);
            color: white;
        }

        .calc-btn.function {
            background: linear-gradient(90deg, #f0a000, #f08000);
            color: white;
        }

        .calc-btn.equal {
            background: #4CAF50;
            color: white;
            grid-column: span 2;
        }

        .calc-tip {
            margin-top: 20px;
            font-size: 13px;
            color: #666;
            text-align: center;
            animation: fadeIn 1s ease 0.6s forwards;
            opacity: 0;
        }

        /* çˆ±å¿ƒå½©è›‹æ ·å¼ */
        .heart {
            position: fixed;
            pointer-events: none;
            animation: heartFall 3s ease-in-out forwards;
            z-index: 9999;
        }

        @keyframes heartFall {
            0% {
                transform: translateY(-50px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        /* å“åº”å¼é€‚é… */
        @media (max-width: 768px) {
            .navbar {
                width: 200px;
                padding: 70px 0 20px;
            }

            .navbar-toggle {
                width: 35px;
                height: 35px;
                font-size: 20px;
            }

            .main-content {
                margin-left: 200px;
                padding: 20px;
                margin-top: 0;
            }

            .main-content.navbar-hidden {
                margin-left: 0;
            }

            .section {
                padding: 25px;
            }

            .tetris-container {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }

            .tetris-sidebar-pc {
                display: none;
            }

            .tetris-info-mobile {
                display: flex;
            }

            .tetris-controls-mobile {
                display: block;
            }

            /* æ‰‹æœºç«¯æ¸¸æˆç•Œé¢ç¼©çŸ­ */
            #tetris-board, #tetris-board-fun {
                width: 240px !important;
                height: 480px !important;
            }

            /* æ‰‹æœºç«¯è®¡ç®—å™¨é€‚é… */
            .calc-buttons {
                gap: 8px;
            }

            .calc-btn {
                padding: 15px;
                font-size: 16px;
            }
        }

        @media (min-width: 769px) {
            .tetris-info-mobile,
            .tetris-controls-mobile {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ æŠ˜å æŒ‰é’®ï¼ˆè‰ºæœ¯å­—Fï¼‰ -->
    <div class="navbar-toggle" onclick="toggleNavbar()">F</div>

    <!-- ä¾§è¾¹å¯¼èˆªæ  -->
    <nav class="navbar" id="navbar">
        <div class="navbar-logo">
            <h2>wpfçš„å·¥å…·ç®±</h2>
            <p>å°å°å·¥å…·</p>
        </div>
        <ul class="nav-list">
            <li class="nav-item">
                <a href="#intro" class="nav-link active" onclick="switchSection('intro')">å…³äºwebsite</a>
            </li>
            <li class="nav-item">
                <a href="#bmi" class="nav-link" onclick="switchSection('bmi')">BMIè®¡ç®—å™¨</a>
            </li>
            <li class="nav-item">
                <a href="#tetris" class="nav-link" onclick="switchSection('tetris')">ä¿„ç½—æ–¯æ–¹å—</a>
            </li>
            <li class="nav-item">
                <a href="#tetris-fun" class="nav-link" onclick="switchSection('tetris-fun')">çˆ½ç‰ˆä¿„ç½—æ–¯æ–¹å—</a>
            </li>
            <li class="nav-item">
                <a href="#calculator" class="nav-link" onclick="switchSection('calculator')">ç§‘å­¦è®¡ç®—å™¨</a>
            </li>
        </ul>
    </nav>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="main-content" id="mainContent">
        <!-- è‡ªæˆ‘ä»‹ç»æ¿å— -->
        <section id="intro" class="section active">
            <div class="intro-header">
                <h2>å…³äºè¿™ä¸ªç½‘ç«™</h2>
            </div>
            <div class="intro-content">
                <p>å¤§å®¶å¥½æˆ‘æ˜¯wpfï¼è¿™æ˜¯ä¸€ä¸ªæœ‰è®¸å¤šå°å·¥å…·çš„ç½‘ç«™ï¼Œç›®å‰åŒ…å«å››ä¸ªæ ¸å¿ƒæ¿å—ï¼š</p>
                <p>1. æ˜¯wokalakaçš„å°å° å·¥å…·ç®± ï¼ï¼ˆåç»­åŠŸèƒ½æ•¬è¯·æœŸå¾…ï¼‰ï¼›</p>
                <p>2. BMIè®¡ç®—å™¨ï¼šè®¡ç®—å¹¶åé¦ˆè¯¦ç»†BMIçŠ¶æ€ï¼›</p>
                <p>3. ä¿„ç½—æ–¯æ–¹å—ï¼šç»å…¸æ€€æ—§æ¸¸æˆï¼Œæ”¯æŒé”®ç›˜æ“ä½œï¼Œå·²é€‚é…æ‰‹æœºï¼›</p>
                <p>4. çˆ½ç‰ˆä¿„ç½—æ–¯æ–¹å—ï¼šåœ¨ç»å…¸ç‰ˆåŸºç¡€ä¸Šå¢åŠ äº†ä¾¿æ·åŠŸèƒ½ï¼›</p>
                <p>5. ç§‘å­¦è®¡ç®—å™¨ï¼šæ”¯æŒåŸºç¡€è¿ç®—ã€å¯¹æ•°ã€æŒ‡æ•°ã€ä¸‰è§’å‡½æ•°ï¼›</p>
                <p>ç½‘ç«™é‡‡ç”¨ç®€æ´ç¾è§‚çš„è®¾è®¡é£æ ¼ï¼Œé€‚é…ç”µè„‘å’Œæ‰‹æœºç­‰å¤šç§è®¾å¤‡ï¼Œå¸Œæœ›èƒ½ç»™ä½ å¸¦æ¥ä¾¿æ·åˆæœ‰è¶£çš„ä½¿ç”¨ä½“éªŒï½</p>
            </div>
            <div class="intro-highlights">
                <div class="highlight-card">
                    <h3>ä¸ªæ€§åŒ–BMIå·¥å…·</h3>
                    <p>å›½é™…é€šç”¨çš„è¡¡é‡äººä½“èƒ–ç˜¦ç¨‹åº¦ä¸å¥åº·çŠ¶å†µçš„æ ‡å‡†ã€‚å¿«æ¥æµ‹ä¸€æµ‹å§ï¼</p>
                </div>
                <div class="highlight-card">
                    <h3>è¶£å‘³æ¸¸æˆ</h3>
                    <p>ç»å…¸ä¿„ç½—æ–¯æ–¹å—å’Œçˆ½ç‰ˆä¿„ç½—æ–¯æ–¹å—ï¼Œç”µè„‘å¯ä½¿ç”¨é”®ç›˜æ“ä½œï¼</p>
                </div>
                <div class="highlight-card">
                    <h3>å®ç”¨å·¥å…·</h3>
                    <p>åŠŸèƒ½å¼ºå¤§çš„ç§‘å­¦è®¡ç®—å™¨ï¼Œæ»¡è¶³æ—¥å¸¸è®¡ç®—å’Œå­¦ä¹ éœ€æ±‚</p>
                </div>
            </div>
        </section>

        <!-- BMIè®¡ç®—å™¨ -->
        <section id="bmi" class="section">
            <div class="bmi-header">
                <h2>BMIè®¡ç®—å™¨</h2>
            </div>
            <div class="bmi-container">
                <h1>æ¬¢è¿ä½¿ç”¨BMIè®¡ç®—å™¨</h1>
                <div class="input-box">
                    <label>è¯·è¾“å…¥ä½ çš„åå­—ï¼š</label><br>
                    <input type="text" id="name" placeholder="ä¾‹å¦‚ï¼šå¥ˆå¥ˆ">
                </div>
                <div class="input-box">
                    <label>è¯·è¾“å…¥ä½ çš„ä½“é‡(kg)ï¼š</label><br>
                    <input type="number" id="weight" step="0.1" placeholder="ä¾‹å¦‚ï¼š50">
                </div>
                <div class="input-box">
                    <label>è¯·è¾“å…¥ä½ çš„èº«é«˜(m)ï¼š</label><br>
                    <input type="number" id="height" step="0.01" placeholder="ä¾‹å¦‚ï¼š1.65 å•ä½æ˜¯m">
                </div>
                <button onclick="calculateBMI()">è®¡ç®—BMI</button>
                <div id="bmi-result"></div>
            </div>
        </section>

        <!-- ç»å…¸ä¿„ç½—æ–¯æ–¹å—æ¿å— -->
        <section id="tetris" class="section">
            <div class="tetris-header">
                <h2>ç»å…¸ä¿„ç½—æ–¯æ–¹å—</h2>
            </div>
            <div class="tetris-container">
                <div class="tetris-main">
                    <canvas id="tetris-board" class="tetris-board" width="300" height="600"></canvas>
                    <div class="tetris-info-mobile">
                        <div class="tetris-info">
                            <h3>åˆ†æ•°</h3>
                            <p id="score-mobile">0</p>
                        </div>
                        <div class="tetris-info">
                            <h3>ç­‰çº§</h3>
                            <p id="level-mobile">1</p>
                        </div>
                    </div>
                </div>
                <div class="tetris-sidebar-pc">
                    <div class="tetris-info">
                        <h3>åˆ†æ•°</h3>
                        <p id="score-pc">0</p>
                    </div>
                    <div class="tetris-info">
                        <h3>ç­‰çº§</h3>
                        <p id="level-pc">1</p>
                    </div>
                    <div class="tetris-controls-pc">
                        <button class="tetris-btn-pc" onclick="tetris.moveLeft()">â† å·¦ç§»</button>
                        <button class="tetris-btn-pc" onclick="tetris.moveRight()">â†’ å³ç§»</button>
                        <button class="tetris-btn-pc" onclick="tetris.rotate()">â†‘ æ—‹è½¬</button>
                        <button class="tetris-btn-pc" onclick="tetris.moveDown()">â†“ ä¸‹ç§»</button>
                        <button class="tetris-btn-pc" onclick="tetris.dropToBottom()">â¬ ä¸€é”®ä¸‹è½</button>
                        <button class="tetris-btn-pc" onclick="tetris.startGame()">å¼€å§‹æ¸¸æˆ</button>
                        <button class="tetris-btn-pc" onclick="tetris.pauseGame()">æš‚åœ/ç»§ç»­</button>
                    </div>
                    <div class="controls-tip">
                        æ”¯æŒé”®ç›˜æ“ä½œï¼šâ†‘æ—‹è½¬ â†â†’ç§»åŠ¨ â†“ä¸‹ç§» ç©ºæ ¼å¿«é€Ÿä¸‹è½
                    </div>
                </div>
            </div>
            <div class="tetris-controls-mobile">
                <div class="control-row">
                    <button class="tetris-btn-mobile" onclick="tetris.moveLeft()">â†</button>
                    <button class="tetris-btn-mobile" onclick="tetris.rotate()">â†‘</button>
                    <button class="tetris-btn-mobile" onclick="tetris.moveRight()">â†’</button>
                </div>
                <div class="control-row">
                    <button class="tetris-btn-mobile" onclick="tetris.startGame()">å¼€å§‹</button>
                    <button class="tetris-btn-mobile" onclick="tetris.moveDown()">â†“</button>
                    <button class="tetris-btn-mobile" onclick="tetris.dropToBottom()">â¬</button>
                </div>
                <div class="control-row">
                    <button class="tetris-btn-mobile" onclick="tetris.pauseGame()">æš‚åœ</button>
                </div>
            </div>
        </section>

        <!-- çˆ½ç‰ˆä¿„ç½—æ–¯æ–¹å—æ¿å— -->
        <section id="tetris-fun" class="section">
            <div class="tetris-header">
                <h2>çˆ½ç‰ˆä¿„ç½—æ–¯æ–¹å—</h2>
            </div>
            <div class="tetris-container">
                <div class="tetris-main">
                    <canvas id="tetris-board-fun" class="tetris-board" width="300" height="600"></canvas>
                    <div class="tetris-info-mobile">
                        <div class="tetris-info">
                            <h3>åˆ†æ•°</h3>
                            <p id="score-mobile-fun">0</p>
                        </div>
                        <div class="tetris-info">
                            <h3>ç­‰çº§</h3>
                            <p id="level-mobile-fun">1</p>
                        </div>
                    </div>
                </div>
                <div class="tetris-sidebar-pc">
                    <div class="tetris-info">
                        <h3>åˆ†æ•°</h3>
                        <p id="score-pc-fun">0</p>
                    </div>
                    <div class="tetris-info">
                        <h3>ç­‰çº§</h3>
                        <p id="level-pc-fun">1</p>
                    </div>
                    <div class="tetris-controls-pc">
                        <button class="tetris-btn-pc" onclick="tetrisFun.moveLeft()">â† å·¦ç§»</button>
                        <button class="tetris-btn-pc" onclick="tetrisFun.moveRight()">â†’ å³ç§»</button>
                        <button class="tetris-btn-pc" onclick="tetrisFun.rotate()">â†‘ æ—‹è½¬</button>
                        <button class="tetris-btn-pc" onclick="tetrisFun.moveDown()">â†“ ä¸‹ç§»</button>
                        <button class="tetris-btn-pc special" onclick="tetrisFun.dropToBottom()">â¬ ä¸€é”®ä¸‹è½</button>
                        <button class="tetris-btn-pc special" onclick="tetrisFun.clearScreen()">ğŸ—‘ï¸ ä¸€é”®æ¸…å±</button>
                        <button class="tetris-btn-pc" onclick="tetrisFun.startGame()">å¼€å§‹æ¸¸æˆ</button>
                        <button class="tetris-btn-pc" onclick="tetrisFun.pauseGame()">æš‚åœ/ç»§ç»­</button>
                    </div>
                    <div class="controls-tip">
                        æ”¯æŒé”®ç›˜æ“ä½œï¼šâ†‘æ—‹è½¬ â†â†’ç§»åŠ¨ â†“ä¸‹ç§» ç©ºæ ¼å¿«é€Ÿä¸‹è½
                    </div>
                </div>
            </div>
            <div class="tetris-controls-mobile">
                <div class="control-row">
                    <button class="tetris-btn-mobile" onclick="tetrisFun.moveLeft()">â†</button>
                    <button class="tetris-btn-mobile" onclick="tetrisFun.rotate()">â†‘</button>
                    <button class="tetris-btn-mobile" onclick="tetrisFun.moveRight()">â†’</button>
                </div>
                <div class="control-row">
                    <button class="tetris-btn-mobile" onclick="tetrisFun.startGame()">å¼€å§‹</button>
                    <button class="tetris-btn-mobile" onclick="tetrisFun.moveDown()">â†“</button>
                    <button class="tetris-btn-mobile special" onclick="tetrisFun.dropToBottom()">â¬</button>
                </div>
                <div class="control-row">
                    <button class="tetris-btn-mobile" onclick="tetrisFun.pauseGame()">æš‚åœ</button>
                    <button class="tetris-btn-mobile special" onclick="tetrisFun.clearScreen()">ğŸ—‘ï¸</button>
                </div>
            </div>
        </section>

        <!-- ç§‘å­¦è®¡ç®—å™¨æ¿å— -->
        <section id="calculator" class="section">
            <div class="calc-header">
                <h2>ç§‘å­¦è®¡ç®—å™¨</h2>
            </div>
            <div class="calc-container">
                <input type="text" id="calc-display" class="calc-display" placeholder="0" oninput="handleDisplayInput()">
                <div class="calc-buttons">
                    <button class="calc-btn function" onclick="appendToDisplay('sin(')">sin</button>
                    <button class="calc-btn function" onclick="appendToDisplay('cos(')">cos</button>
                    <button class="calc-btn function" onclick="appendToDisplay('tan(')">tan</button>
                    <button class="calc-btn function" onclick="appendToDisplay('log(')">log</button>
                    
                    <button class="calc-btn function" onclick="appendToDisplay('ln(')">ln</button>
                    <button class="calc-btn function" onclick="appendToDisplay('^2')">xÂ²</button>
                    <button class="calc-btn function" onclick="appendToDisplay('sqrt(')">âˆš</button>
                    <button class="calc-btn operator" onclick="appendToDisplay('/')">Ã·</button>
                    
                    <button class="calc-btn" onclick="appendToDisplay('7')">7</button>
                    <button class="calc-btn" onclick="appendToDisplay('8')">8</button>
                    <button class="calc-btn" onclick="appendToDisplay('9')">9</button>
                    <button class="calc-btn operator" onclick="appendToDisplay('*')">Ã—</button>
                    
                    <button class="calc-btn" onclick="appendToDisplay('4')">4</button>
                    <button class="calc-btn" onclick="appendToDisplay('5')">5</button>
                    <button class="calc-btn" onclick="appendToDisplay('6')">6</button>
                    <button class="calc-btn operator" onclick="appendToDisplay('-')">âˆ’</button>
                    
                    <button class="calc-btn" onclick="appendToDisplay('1')">1</button>
                    <button class="calc-btn" onclick="appendToDisplay('2')">2</button>
                    <button class="calc-btn" onclick="appendToDisplay('3')">3</button>
                    <button class="calc-btn operator" onclick="appendToDisplay('+')">+</button>
                    
                    <button class="calc-btn" onclick="appendToDisplay('(')">()</button>
                    <button class="calc-btn" onclick="appendToDisplay('0')">0</button>
                    <button class="calc-btn" onclick="appendToDisplay('.')">.</button>
                    <button class="calc-btn operator" onclick="appendToDisplay(')')">)</button>
                    
                    <button class="calc-btn function" onclick="clearDisplay()">AC</button>
                    <button class="calc-btn function" onclick="deleteLastChar()">DEL</button>
                    <button class="calc-btn equal" onclick="calculateResult()">=</button>
                </div>
                <div class="calc-tip">
                    æ”¯æŒåŸºç¡€è¿ç®—ã€ä¸‰è§’å‡½æ•°ã€å¯¹æ•°æŒ‡æ•° | æ”¯æŒé”®ç›˜è¾“å…¥
                </div>
            </div>
        </section>
    </div>

    <script>
        // 1. å¯¼èˆªæ æŠ˜å /å±•å¼€åŠŸèƒ½ï¼ˆç”µè„‘+æ‰‹æœºé€šç”¨ï¼‰
        const navbar = document.getElementById('navbar');
        const mainContent = document.getElementById('mainContent');
        
        function toggleNavbar() {
            navbar.classList.toggle('hidden');
            mainContent.classList.toggle('navbar-hidden');
        }

        // 2. æ¿å—åˆ‡æ¢åŠŸèƒ½
        function switchSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            const targetSection = document.getElementById(sectionId);
            targetSection.classList.add('active');
            document.querySelector(`.nav-link[href="#${sectionId}"]`).classList.add('active');
            
            // æ¿å—åˆ‡æ¢åŠ¨ç”»é‡ç½®
            targetSection.style.opacity = '0';
            targetSection.style.transform = 'translateY(30px)';
            setTimeout(() => {
                targetSection.style.opacity = '1';
                targetSection.style.transform = 'translateY(0)';
            }, 50);
        }

        // 3. BMIè®¡ç®—å™¨
        function calculateBMI() {
            const name = document.getElementById("name").value;
            const weight = parseFloat(document.getElementById("weight").value);
            const height = parseFloat(document.getElementById("height").value);
            const resultEl = document.getElementById("bmi-result");
            
            // è¾“å…¥éªŒè¯
            if (!name || isNaN(weight) || isNaN(height) || height <= 0 || weight <= 0) {
                resultEl.textContent = "è¯·è¾“å…¥æ­£ç¡®çš„ä¿¡æ¯å“¦ï¼";
                resultEl.className = "show";
                resultEl.style.background = "rgba(239, 68, 68, 0.1)";
                resultEl.style.color = "#ef4444";
                return;
            }
            
            // è®¡ç®—BMI
            const bmi = weight / (height ** 2);
            const bmiRounded = bmi.toFixed(2);
            let status, bgColor, textColor;
            
            if (bmi < 18.5) {
                status = "æ‚¨å±äºè¿‡è½»";
                bgColor = "rgba(102, 126, 234, 0.1)";
                textColor = "#667eea";
            } else if (bmi >= 18.5 && bmi <= 25) {
                status = "æ‚¨å±äºæ­£å¸¸";
                bgColor = "rgba(72, 187, 120, 0.1)";
                textColor = "#48bb78";
            } else if (bmi > 25 && bmi < 28) {
                status = "æ‚¨å±äºè¿‡é‡";
                bgColor = "rgba(246, 190, 0, 0.1)";
                textColor = "#f6be00";
            } else if (bmi >= 28 && bmi < 32) {
                status = "æ‚¨å±äºè‚¥èƒ–";
                bgColor = "rgba(239, 68, 68, 0.1)";
                textColor = "#ef4444";
            } else {
                status = "æ‚¨å±äºä¸¥é‡è‚¥èƒ–";
                bgColor = "rgba(220, 38, 38, 0.1)";
                textColor = "#dc2626";
            }
            
            // æ˜¾ç¤ºç»“æœ
            resultEl.textContent = `Hello ${name}ï¼ä½ çš„BMIæ˜¯ ${bmiRounded}ï¼Œ${status}`;
            resultEl.style.background = bgColor;
            resultEl.style.color = textColor;
            resultEl.classList.add("show");
        }

        // 4. ä¿„ç½—æ–¯æ–¹å—æ ¸å¿ƒç±»ï¼ˆé€šç”¨é€»è¾‘ï¼‰
        class TetrisGame {
            constructor(canvasId, scoreElements, levelElements, isFunVersion = false) {
                this.canvas = document.getElementById(canvasId);
                this.ctx = this.canvas.getContext('2d');
                this.gridSize = 30;
                this.rows = this.canvas.height / this.gridSize;
                this.cols = this.canvas.width / this.gridSize;
                this.board = [];
                this.currentPiece = null;
                this.score = 0;
                this.level = 1;
                this.linesCleared = 0;
                this.gameInterval = null;
                this.isPaused = false;
                this.isGameOver = false;
                this.scoreElements = scoreElements;
                this.levelElements = levelElements;
                this.isFunVersion = isFunVersion;
                this.isNavbarHidden = false;
                this.touchStartY = 0;
                
                // æ–¹å—å½¢çŠ¶å®šä¹‰
                this.shapes = [
                    [[1, 1, 1, 1]], // Iå‹
                    [[1, 1], [1, 1]], // Oå‹
                    [[1, 1, 1], [0, 1, 0]], // Tå‹
                    [[1, 1, 1], [1, 0, 0]], // Lå‹
                    [[1, 1, 1], [0, 0, 1]], // Jå‹
                    [[1, 1, 0], [0, 1, 1]], // Så‹
                    [[0, 1, 1], [1, 1, 0]]  // Zå‹
                ];

                // æ–¹å—é¢œè‰²
                this.colors = [
                    '#00f0f0', '#f0f000', '#a000f0', '#f0a000',
                    '#0000f0', '#00f000', '#f00000'
                ];
                
                this.initBoard();
                this.setupEventListeners();
                this.setupTouchListeners();
            }
            
            // åˆå§‹åŒ–æ¸¸æˆé¢æ¿
            initBoard() {
                this.board = Array(this.rows).fill().map(() => Array(this.cols).fill(0));
            }
            
            // éšæœºç”Ÿæˆæ–¹å—
            generatePiece() {
                const shapeIndex = Math.floor(Math.random() * this.shapes.length);
                const shape = this.shapes[shapeIndex];
                const color = this.colors[shapeIndex];
                const x = Math.floor(this.cols / 2) - Math.floor(shape[0].length / 2);
                const y = 0;
                return { shape, color, x, y };
            }
            
            // ç»˜åˆ¶ç½‘æ ¼çº¿
            drawGrid() {
                this.ctx.strokeStyle = '#e0e0e0';
                this.ctx.lineWidth = 0.5;
                // ç«–çº¿
                for (let x = 0; x <= this.canvas.width; x += this.gridSize) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(x, 0);
                    this.ctx.lineTo(x, this.canvas.height);
                    this.ctx.stroke();
                }
                // æ¨ªçº¿
                for (let y = 0; y <= this.canvas.height; y += this.gridSize) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(0, y);
                    this.ctx.lineTo(this.canvas.width, y);
                    this.ctx.stroke();
                }
            }
            
            // ç»˜åˆ¶æ¸¸æˆé¢æ¿
            drawBoard() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                this.drawGrid();
                // ç»˜åˆ¶å·²é”å®šçš„æ–¹å—
                this.board.forEach((row, y) => {
                    row.forEach((cell, x) => {
                        if (cell) {
                            this.drawCell(x, y, cell);
                        }
                    });
                });
            }
            
            // ç»˜åˆ¶å•ä¸ªæ–¹å—
            drawCell(x, y, color) {
                this.ctx.fillStyle = color;
                this.ctx.fillRect(x * this.gridSize, y * this.gridSize, this.gridSize - 1, this.gridSize - 1);
                this.ctx.strokeStyle = '#fff';
                this.ctx.strokeRect(x * this.gridSize, y * this.gridSize, this.gridSize - 1, this.gridSize - 1);
            }
            
            // ç»˜åˆ¶å½“å‰ä¸‹è½æ–¹å—
            drawPiece() {
                if (!this.currentPiece) return;
                this.currentPiece.shape.forEach((row, y) => {
                    row.forEach((cell, x) => {
                        if (cell) {
                            const drawX = this.currentPiece.x + x;
                            const drawY = this.currentPiece.y + y;
                            if (drawY >= 0) {
                                this.drawCell(drawX, drawY, this.currentPiece.color);
                            }
                        }
                    });
                });
            }
            
            // ç¢°æ’æ£€æµ‹
            checkCollision(piece, offsetX = 0, offsetY = 0) {
                for (let y = 0; y < piece.shape.length; y++) {
                    for (let x = 0; x < piece.shape[y].length; x++) {
                        if (piece.shape[y][x]) {
                            const newX = piece.x + x + offsetX;
                            const newY = piece.y + y + offsetY;
                            if (
                                newX < 0 || newX >= this.cols ||
                                newY >= this.rows ||
                                (newY >= 0 && this.board[newY][newX])
                            ) {
                                return true;
                            }
                        }
                    }
                }
                return false;
            }
            
            // æ—‹è½¬æ–¹å—
            rotate() {
                if (this.isPaused || !this.currentPiece) return;
                const rotatedShape = this.currentPiece.shape[0].map((_, index) =>
                    this.currentPiece.shape.map(row => row[index]).reverse()
                );
                const newPiece = { ...this.currentPiece, shape: rotatedShape };
                if (!this.checkCollision(newPiece)) {
                    this.currentPiece = newPiece;
                }
                this.draw();
            }
            
            // ç§»åŠ¨æ–¹å—
            move(dx, dy) {
                if (this.isPaused || !this.currentPiece) return;
                if (!this.checkCollision(this.currentPiece, dx, dy)) {
                    this.currentPiece.x += dx;
                    this.currentPiece.y += dy;
                    this.draw();
                    return true;
                }
                return false;
            }
            
            // å·¦ç§»
            moveLeft() {
                this.move(-1, 0);
            }
            
            // å³ç§»
            moveRight() {
                this.move(1, 0);
            }
            
            // ä¸‹ç§»
            moveDown() {
                if (!this.move(0, 1)) {
                    this.lockPiece();
                }
            }
            
            // ä¸€é”®ä¸‹è½åˆ°åº•éƒ¨
            dropToBottom() {
                if (this.isPaused || !this.currentPiece) return;
                let dropDistance = 0;
                while (!this.checkCollision(this.currentPiece, 0, dropDistance + 1)) {
                    dropDistance++;
                }
                this.currentPiece.y += dropDistance;
                this.draw();
                setTimeout(() => this.lockPiece(), 50);
            }
            
            // é”å®šæ–¹å—åˆ°é¢æ¿
            lockPiece() {
                this.currentPiece.shape.forEach((row, y) => {
                    row.forEach((cell, x) => {
                        if (cell) {
                            const newY = this.currentPiece.y + y;
                            if (newY >= 0) {
                                this.board[newY][this.currentPiece.x + x] = this.currentPiece.color;
                            }
                        }
                    });
                });
                this.clearLines();
                this.currentPiece = this.generatePiece();
                if (this.checkCollision(this.currentPiece)) {
                    this.gameOver();
                }
                this.draw();
            }
            
            // è®¡ç®—æ–¹å—å †å é«˜åº¦
            getStackHeight() {
                for (let y = 0; y < this.rows; y++) {
                    if (this.board[y].some(cell => cell !== 0)) {
                        return this.rows - y;
                    }
                }
                return 0;
            }
            
            // æ ¹æ®å †å é«˜åº¦è°ƒæ•´é€Ÿåº¦
            adjustSpeedByHeight() {
                if (!this.isFunVersion) return 1000 / this.level;
                
                const stackHeight = this.getStackHeight();
                const halfHeight = this.rows / 2;
                
                // å½“æ–¹å—å †å è¶…è¿‡ä¸€åŠé«˜åº¦æ—¶ï¼Œå¼€å§‹å‡æ…¢é€Ÿåº¦
                if (stackHeight > halfHeight) {
                    // å †å è¶Šé«˜ï¼Œå‡é€Ÿè¶Šå¤šï¼Œæœ€å¤šå‡é€Ÿ50%
                    const excess = stackHeight - halfHeight;
                    const maxExcess = halfHeight;
                    const slowFactor = 1 + (excess / maxExcess) * 0.5;
                    return (1000 / this.level) * slowFactor;
                }
                
                return 1000 / this.level;
            }
            
            // æ¶ˆé™¤å®Œæ•´è¡Œ
            clearLines() {
                let lines = 0;
                const linesToClear = [];
                this.board.forEach((row, y) => {
                    if (!row.includes(0)) {
                        lines++;
                        linesToClear.push(y);
                    }
                });
                
                if (lines > 0) {
                    // é—ªçƒåŠ¨ç”»
                    linesToClear.forEach(y => {
                        this.board[y] = Array(this.cols).fill('#ff000033');
                    });
                    this.draw();
                    
                    setTimeout(() => {
                        // çœŸæ­£æ¶ˆé™¤è¡Œ
                        this.board = this.board.filter(row => row.includes(0));
                        while (this.board.length < this.rows) {
                            this.board.unshift(Array(this.cols).fill(0));
                        }
                        
                        // æ›´æ–°åˆ†æ•°å’Œç­‰çº§
                        this.linesCleared += lines;
                        this.score += lines * 100 * this.level;
                        
                        if (this.linesCleared >= this.level * 10) {
                            this.level++;
                            this.updateLevelDisplay();
                            this.restartInterval();
                        }
                        
                        this.updateScoreDisplay();
                        this.draw();
                    }, 200);
                }
            }
            
            // ä¸€é”®æ¸…å±ï¼ˆä¿®å¤bugï¼šç¡®ä¿å®Œå…¨æ¸…ç©ºé¢æ¿ï¼‰
            clearScreen() {
                if (!this.isFunVersion || this.isGameOver || this.isPaused) return;
                
                // å®Œå…¨æ¸…ç©ºæ¸¸æˆé¢æ¿
                this.initBoard();
                // é‡æ–°ç”Ÿæˆå½“å‰ä¸‹è½æ–¹å—
                this.currentPiece = this.generatePiece();
                // ç«‹å³é‡ç»˜
                this.draw();
                
                // æ¸…å±åŠ¨ç”»æ•ˆæœ
                this.ctx.save();
                this.ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                this.ctx.restore();
                
                setTimeout(() => this.draw(), 150);
            }
            
            // æ›´æ–°åˆ†æ•°æ˜¾ç¤º
            updateScoreDisplay() {
                this.scoreElements.forEach(el => {
                    el.textContent = this.score;
                    el.classList.add('update');
                    setTimeout(() => el.classList.remove('update'), 500);
                });
            }
            
            // æ›´æ–°ç­‰çº§æ˜¾ç¤º
            updateLevelDisplay() {
                this.levelElements.forEach(el => {
                    el.textContent = this.level;
                    el.classList.add('update');
                    setTimeout(() => el.classList.remove('update'), 500);
                });
            }
            
            // ç»˜åˆ¶æ¸¸æˆ
            draw() {
                this.drawBoard();
                this.drawPiece();
            }
            
            // æ¸¸æˆä¸»å¾ªç¯
            gameLoop() {
                if (!this.isPaused && !this.isGameOver) {
                    this.moveDown();
                }
            }
            
            // é‡æ–°å¼€å§‹è®¡æ—¶å™¨ï¼ˆç”¨äºç­‰çº§å˜åŒ–æ—¶ï¼‰
            restartInterval() {
                if (this.gameInterval) {
                    clearInterval(this.gameInterval);
                }
                const speed = this.adjustSpeedByHeight();
                this.gameInterval = setInterval(() => this.gameLoop(), speed);
            }
            
            // å¼€å§‹æ¸¸æˆ
            startGame() {
                if (this.isGameOver || this.gameInterval) {
                    this.resetGame();
                }
                
                this.isPaused = false;
                this.isGameOver = false;
                this.currentPiece = this.generatePiece();
                this.restartInterval();
                this.draw();
            }
            
            // æš‚åœ/ç»§ç»­æ¸¸æˆ
            pauseGame() {
                if (this.isGameOver || !this.gameInterval) return;
                
                this.isPaused = !this.isPaused;
                if (this.isPaused) {
                    this.ctx.save();
                    this.ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                    this.ctx.fillStyle = 'white';
                    this.ctx.font = '20px Arial';
                    this.ctx.textAlign = 'center';
                    this.ctx.fillText('å·²æš‚åœ', this.canvas.width / 2, this.canvas.height / 2);
                    this.ctx.restore();
                }
            }
            
            // é‡ç½®æ¸¸æˆ
            resetGame() {
                if (this.gameInterval) {
                    clearInterval(this.gameInterval);
                    this.gameInterval = null;
                }
                
                this.initBoard();
                this.score = 0;
                this.level = 1;
                this.linesCleared = 0;
                this.isPaused = false;
                this.isGameOver = false;
                
                this.updateScoreDisplay();
                this.updateLevelDisplay();
                this.draw();
            }
            
            // æ¸¸æˆç»“æŸ
            gameOver() {
                clearInterval(this.gameInterval);
                this.gameInterval = null;
                this.isGameOver = false;
                
                // æ¸¸æˆç»“æŸæ—¶æ˜¾ç¤ºå¯¼èˆªæ 
                if (this.isNavbarHidden) {
                    toggleNavbar();
                    this.isNavbarHidden = false;
                }
                
                this.ctx.save();
                this.ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                this.ctx.fillStyle = 'white';
                this.ctx.font = '20px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.fillText('æ¸¸æˆç»“æŸ', this.canvas.width / 2, this.canvas.height / 2 - 20);
                this.ctx.fillText(`åˆ†æ•°: ${this.score}`, this.canvas.width / 2, this.canvas.height / 2 + 20);
                this.ctx.fillText('ç‚¹å‡»å¼€å§‹æŒ‰é’®é‡æ–°æ¸¸æˆ', this.canvas.width / 2, this.canvas.height / 2 + 50);
                this.ctx.restore();
            }
            
            // è®¾ç½®é”®ç›˜äº‹ä»¶ç›‘å¬
            setupEventListeners() {
                // é”®ç›˜æ§åˆ¶
                document.addEventListener('keydown', (e) => {
                    // é˜»æ­¢ä¸Šä¸‹é”®å¯¼è‡´é¡µé¢æ»šåŠ¨
                    if (e.key === 'ArrowUp' || e.key === 'ArrowDown') {
                        e.preventDefault();
                    }
                    
                    // åªåœ¨å½“å‰æ¸¸æˆæ¿å—æ¿€æ´»æ—¶å“åº”é”®ç›˜äº‹ä»¶
                    const isActive = document.getElementById(this.isFunVersion ? 'tetris-fun' : 'tetris').classList.contains('active');
                    if (!isActive) return;
                    
                    switch(e.key) {
                        case 'ArrowLeft':
                            this.moveLeft();
                            break;
                        case 'ArrowRight':
                            this.moveRight();
                            break;
                        case 'ArrowUp':
                            this.rotate();
                            break;
                        case 'ArrowDown':
                            this.moveDown();
                            break;
                        case ' ': // ç©ºæ ¼é”®å¿«é€Ÿä¸‹è½
                            this.dropToBottom();
                            break;
                        case 'p':
                        case 'P':
                            this.pauseGame();
                            break;
                    }
                });
                
                // é¼ æ ‡æ»šè½®æ§åˆ¶å¯¼èˆªæ æ˜¾ç¤º/éšè—ï¼ˆç”µè„‘ç«¯ï¼‰
                this.canvas.addEventListener('wheel', (e) => {
                    if (!this.gameInterval || this.isGameOver) return;
                    
                    // å‘ä¸Šæ»šåŠ¨éšè—å¯¼èˆªæ 
                    if (e.deltaY < 0 && !this.isNavbarHidden) {
                        toggleNavbar();
                        this.isNavbarHidden = true;
                    }
                    // å‘ä¸‹æ»šåŠ¨æ˜¾ç¤ºå¯¼èˆªæ 
                    else if (e.deltaY > 0 && this.isNavbarHidden) {
                        toggleNavbar();
                        this.isNavbarHidden = false;
                    }
                });
            }
            
            // è®¾ç½®è§¦æ‘¸äº‹ä»¶ç›‘å¬ï¼ˆæ‰‹æœºç«¯ï¼‰
            setupTouchListeners() {
                // è§¦æ‘¸å¼€å§‹
                this.canvas.addEventListener('touchstart', (e) => {
                    if (!this.gameInterval || this.isGameOver) return;
                    this.touchStartY = e.touches[0].clientY;
                }, { passive: true });
                
                // è§¦æ‘¸ç§»åŠ¨
                this.canvas.addEventListener('touchmove', (e) => {
                    if (!this.gameInterval || this.isGameOver || this.isPaused) return;
                    
                    const touchY = e.touches[0].clientY;
                    const deltaY = touchY - this.touchStartY;
                    
                    // ä¸Šæ»‘éšè—å¯¼èˆªæ ï¼ˆæ»‘åŠ¨è·ç¦»è¶…è¿‡50pxï¼‰
                    if (deltaY < -50 && !this.isNavbarHidden) {
                        toggleNavbar();
                        this.isNavbarHidden = true;
                        this.touchStartY = touchY;
                    }
                    // ä¸‹æ»‘æ˜¾ç¤ºå¯¼èˆªæ ï¼ˆæ»‘åŠ¨è·ç¦»è¶…è¿‡50pxï¼‰
                    else if (deltaY > 50 && this.isNavbarHidden) {
                        toggleNavbar();
                        this.isNavbarHidden = false;
                        this.touchStartY = touchY;
                    }
                }, { passive: true });
            }
        }
        
        // åˆå§‹åŒ–ç»å…¸ç‰ˆä¿„ç½—æ–¯æ–¹å—
        const tetris = new TetrisGame(
            'tetris-board',
            [document.getElementById('score-mobile'), document.getElementById('score-pc')],
            [document.getElementById('level-mobile'), document.getElementById('level-pc')],
            false
        );
        
        // åˆå§‹åŒ–çˆ½ç‰ˆä¿„ç½—æ–¯æ–¹å—
        const tetrisFun = new TetrisGame(
            'tetris-board-fun',
            [document.getElementById('score-mobile-fun'), document.getElementById('score-pc-fun')],
            [document.getElementById('level-mobile-fun'), document.getElementById('level-pc-fun')],
            true
        );
        
        // åˆå§‹ç»˜åˆ¶
        tetris.draw();
        tetrisFun.draw();

        // 5. ç§‘å­¦è®¡ç®—å™¨é€»è¾‘ï¼ˆä¿®å¤æ‰€æœ‰bugï¼‰
        let displayValue = '';
        const display = document.getElementById('calc-display');
        // å…è®¸è¾“å…¥çš„æ±‰å­—
        const allowedChars = ['å¥ˆ', 'å¥ˆ', 'ç†Š', 'è€', 'å¤´', 'æŠ«', 'è¨'];
        const allowedFullChars = ['å¥ˆå¥ˆ', 'ç†Š', 'è€å¤´', 'æŠ«è¨'];
        
        // å¤„ç†è¾“å…¥æ¡†è¾“å…¥ï¼ˆåªå…è®¸ç‰¹å®šæ±‰å­—ï¼‰
        function handleDisplayInput() {
            let input = display.value;
            // è¿‡æ»¤ä¸å…è®¸çš„å­—ç¬¦
            let filtered = '';
            for (let char of input) {
                if (allowedChars.includes(char) || /[0-9+\-*/.()^]/.test(char)) {
                    filtered += char;
                }
            }
            displayValue = filtered;
            display.value = displayValue;
            // æ£€æŸ¥å½©è›‹
            checkEasterEgg();
        }
        
        // è¿½åŠ å†…å®¹åˆ°æ˜¾ç¤ºå±
        function appendToDisplay(value) {
            // å¤„ç†å¹³æ–¹åŠŸèƒ½ï¼ˆxÂ²ï¼‰
            if (value === '^2') {
                // å¦‚æœå·²æœ‰æ•°å­—ï¼Œç›´æ¥åŠ å¹³æ–¹
                if (displayValue && !isNaN(displayValue[displayValue.length - 1])) {
                    displayValue += '**2';
                } else {
                    displayValue += value;
                }
            } else {
                displayValue += value;
            }
            display.value = displayValue;
            checkEasterEgg();
        }
        
        // æ¸…ç©ºæ˜¾ç¤ºå±
        function clearDisplay() {
            displayValue = '';
            display.value = '0';
        }
        
        // åˆ é™¤æœ€åä¸€ä¸ªå­—ç¬¦
        function deleteLastChar() {
            displayValue = displayValue.slice(0, -1);
            display.value = displayValue || '0';
        }
        
        // è®¡ç®—ç»“æœï¼ˆä¿®å¤ä¸‰è§’å‡½æ•°ã€å¼€æ ¹å·é€»è¾‘ï¼‰
        function calculateResult() {
            try {
                let expression = displayValue;
                
                // å¤„ç†ä¸‰è§’å‡½æ•°ï¼ˆè‡ªåŠ¨è½¬æ¢è§’åº¦ä¸ºå¼§åº¦ï¼‰
                expression = expression
                    .replace(/sin\(/g, 'Math.sin(Math.PI*(')
                    .replace(/cos\(/g, 'Math.cos(Math.PI*(')
                    .replace(/tan\(/g, 'Math.tan(Math.PI*(')
                    .replace(/\))/g, ')/180)')
                    .replace(/log\(/g, 'Math.log10(')
                    .replace(/ln\(/g, 'Math.log(')
                    .replace(/sqrt\(/g, 'Math.sqrt(');
                
                // å¤„ç†å…ˆè¾“å…¥æ•°å­—åç‚¹å‡»æ ¹å·çš„æƒ…å†µï¼ˆå¦‚16âˆš â†’ âˆš16ï¼‰
                expression = expression.replace(/(\d+(\.\d+)?)(sqrt\()/g, 'sqrt($1)');
                
                // è®¡ç®—ç»“æœï¼ˆé™åˆ¶ç²¾åº¦ï¼‰
                const result = eval(expression);
                const formattedResult = Number.isInteger(result) ? result : result.toFixed(6);
                displayValue = formattedResult;
                display.value = formattedResult;
            } catch (error) {
                display.value = 'é”™è¯¯';
                displayValue = '';
            }
        }
        
        // å½©è›‹åŠŸèƒ½ï¼ˆä¿®å¤çˆ±å¿ƒæ˜¾ç¤ºbugï¼‰
        function checkEasterEgg() {
            const triggers = ['å¥ˆå¥ˆ+ç†Š', 'è€å¤´+æŠ«è¨'];
            const isTriggered = triggers.some(trigger => displayValue.includes(trigger));
            
            if (isTriggered) {
                // è§¦å‘å½©è›‹åæ¸…ç©ºè¾“å…¥ï¼Œé¿å…é‡å¤è§¦å‘
                displayValue = '';
                display.value = 'å½©è›‹è§¦å‘ï¼';
                
                // ç”Ÿæˆçˆ±å¿ƒé›¨ï¼ˆä¿®å¤æ˜¾ç¤ºbugï¼‰
                createHeartRain();
                
                // 5ç§’åæ¢å¤é»˜è®¤æ˜¾ç¤º
                setTimeout(() => {
                    display.value = '0';
                }, 5000);
            }
        }
        
        // åˆ›å»ºçˆ±å¿ƒé›¨æ•ˆæœï¼ˆä¿®å¤åŠ¨ç”»bugï¼‰
        function createHeartRain() {
            const colors = ['#ff69b4', '#4169e1', '#ff0000']; // ç²‰ã€è“ã€çº¢
            const duration = 5000;
            const startTime = Date.now();
            let heartCount = 0;
            
            // æŒç»­ç”Ÿæˆçˆ±å¿ƒ
            function createHeart() {
                if (Date.now() - startTime > duration || heartCount > 200) return;
                
                const heart = document.createElement('div');
                heart.className = 'heart';
                
                // éšæœºçˆ±å¿ƒé¢œè‰²ã€å¤§å°ã€ä½ç½®
                const color = colors[Math.floor(Math.random() * colors.length)];
                const size = Math.random() * 20 + 10;
                const left = Math.random() * 100;
                const animationDuration = Math.random() * 2 + 1;
                
                heart.style.color = color;
                heart.style.fontSize = `${size}px`;
                heart.style.left = `${left}%`;
                heart.innerHTML = 'â¤ï¸';
                heart.style.animationDuration = `${animationDuration}s`;
                
                document.body.appendChild(heart);
                heartCount++;
                
                // åŠ¨ç”»ç»“æŸåç§»é™¤çˆ±å¿ƒå…ƒç´ 
                setTimeout(() => {
                    try {
                        heart.remove();
                    } catch (e) {}
                }, animationDuration * 1000);
                
                // ç»§ç»­ç”Ÿæˆçˆ±å¿ƒ
                requestAnimationFrame(createHeart);
            }
            
            // ç«‹å³å¼€å§‹ç”Ÿæˆ
            createHeart();
            // æ¯éš”50msç”Ÿæˆä¸€ä¸ªï¼Œç¡®ä¿çˆ±å¿ƒå¯†åº¦
            const interval = setInterval(createHeart, 50);
            // 5ç§’ååœæ­¢ç”Ÿæˆ
            setTimeout(() => clearInterval(interval), duration);
        }
        
        // é”®ç›˜æ”¯æŒï¼ˆåªå…è®¸ç‰¹å®šè¾“å…¥ï¼‰
        document.addEventListener('keydown', (e) => {
            const isCalcActive = document.getElementById('calculator').classList.contains('active');
            if (!isCalcActive) return;
            
            const key = e.key;
            // å…è®¸çš„é”®ç›˜è¾“å…¥ï¼šæ•°å­—ã€è¿ç®—ç¬¦ã€ç‰¹å®šæ±‰å­—
            if (/[0-9+\-*/.()^]/.test(key)) {
                appendToDisplay(key);
            } else if (allowedChars.includes(key)) {
                appendToDisplay(key);
            } else if (key === 'Enter') {
                calculateResult();
            } else if (key === 'Escape') {
                clearDisplay();
            } else if (key === 'Backspace') {
                deleteLastChar();
            }
        });
    </script>
</body>
</html>